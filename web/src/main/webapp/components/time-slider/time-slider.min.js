!function(w,$){"use strict";var TimeSlider=function(id,options){this.$snap=$("#"+id),this.snap=Snap("#"+id),this._init(options),this._initControlClass(),this._addInnerEventListener()};TimeSlider.prototype._init=function(options){this.groups={},this._aListener={inEvent:[],outEvent:[],clickEvent:[],selectTime:[],changeSliderTimeSeries:[],changeSelectionZone:[]},this.opt={duration:300,xAxisTicks:5,eventZoneHeight:30,headerZoneHeight:20,stateLineThickness:4,minSliderTimeSeries:6e3,maxSliderTimeSeries:1728e5,headerTextTopPadding:10,selectionPointRadius:5},this.opt.minSliderTimeSeries=1e3*(this.opt.xAxisTicks+1);var p;for(p in options)this.opt[p]=options[p];this.oEventData=new TimeSlider.EventData(this,this.opt.eventData||[]),this._checkOffset()},TimeSlider.prototype._initControlClass=function(options){this.oPositionManager=new TimeSlider.PositionManager({width:this.opt.width,selectTime:this.opt.selectTime,xAxisTicks:this.opt.xAxisTicks,handleTimeSeries:this.opt.handleTimeSeries,sliderTimeSeries:this.opt.timeSeries,minSliderTimeSeries:this.opt.minSliderSeries,maxSliderSeries:this.opt.maxSliderSeries});var contentZoneHeight=this.opt.height-this.opt.headerZoneHeight-this.opt.eventZoneHeight;this.oLoading=new TimeSlider.LoadingIndicator(this,this.getGroup("loading",TimeSlider.GROUP_TYPE.TOP_BASE,TimeSlider.oDrawOrder.loading),{width:this.opt.width,height:this.opt.height,duration:2e3}),this.oBackground=new TimeSlider.Background(this,this.getGroup("background",TimeSlider.GROUP_TYPE.CONTENT_BASE,TimeSlider.oDrawOrder.background),{top:0,left:0,width:this.opt.width,height:contentZoneHeight,duration:this.opt.duration}),this.oSelectionManager=new TimeSlider.SelectionManager(this,{margin:this.opt.left,height:this.opt.height,duration:this.opt.duration,handleSrc:this.opt.handleSrc,eventZoneHeight:this.opt.eventZoneHeight,headerZoneHeight:this.opt.headerZoneHeight,contentZoneHeight:contentZoneHeight,selectionPointRadius:this.opt.selectionPointRadius}),this.oXAxis=new TimeSlider.XAxis(this,this.getGroup("x-axis",TimeSlider.GROUP_TYPE.TOP_BASE,TimeSlider.oDrawOrder["x-axis"]),{endY:this.opt.height-this.opt.eventZoneHeight,width:this.opt.width,textY:this.opt.headerTextTopPadding,startY:this.opt.headerZoneHeight,duration:this.opt.duration}),this.oStateLine=new TimeSlider.StateLine(this,this.getGroup("state-line",TimeSlider.GROUP_TYPE.TOP_BASE,TimeSlider.oDrawOrder["state-line"]),{width:this.opt.width,duration:this.opt.duration,topLineY:this.opt.headerZoneHeight,thickness:this.opt.stateLineThickness,timeSeries:this.opt.timeSeries,bottomLineY:this.opt.height-this.opt.eventZoneHeight}),this.oEvents=new TimeSlider.Events(this,this.getGroup("events",TimeSlider.GROUP_TYPE.BOTTOM_BASE,TimeSlider.oDrawOrder.events),{duration:this.opt.duration}),this.oLoading.hide()},TimeSlider.prototype.getGroup=function(name,type,zIndex){if(this.groups[name])return this.groups[name];var g=this.groups[name]=this.snap.g().attr({"class":name,"data-order":zIndex});return this._setTransform(g,type),this._sortGroup(g,zIndex),this.groups[name]},TimeSlider.prototype._setTransform=function(newGroup,type){switch(type){case TimeSlider.GROUP_TYPE.TOP_BASE:break;case TimeSlider.GROUP_TYPE.CONTENT_BASE:newGroup.attr({transform:"translate(0, "+this.opt.headerZoneHeight+")"});break;case TimeSlider.GROUP_TYPE.BOTTOM_BASE:newGroup.attr({transform:"translate(0, "+(this.opt.height-this.opt.eventZoneHeight)+")"})}},TimeSlider.prototype._sortGroup=function(newGroup,zIndex){for(var aGroups=this.snap.selectAll("g"),afterGroup=null,i=aGroups.length-1;i>=0;i--)aGroups[i]!=newGroup&&zIndex<parseInt(aGroups[i].attr("data-order"))&&(afterGroup=aGroups[i]);null!==afterGroup&&afterGroup.before(newGroup)},TimeSlider.prototype._checkOffset=function(){var o=this.$snap.offset();this.opt.top=o.top,this.opt.left=o.left},TimeSlider.prototype._addInnerEventListener=function(){var self=this,mousedownX=-1;$(window).on("resize",function(){self._checkOffset(),self._resize()}),this.snap.mousemove(function(event,x,y){}),this.snap.mouseout(function(event,x,y){}),this.snap.mousedown(function(event,x,y){mousedownX=x}),this.snap.click(function(event,x,y){mousedownX===x&&self.oSelectionManager.onMouseClick(event,x-self.opt.left,y-self.opt.top)})},TimeSlider.prototype.fireEvent=function(eventType,argu){this._aListener[eventType].forEach(function(fn){fn(argu)})},TimeSlider.prototype.addEvent=function(eventType,listener){return this._aListener[eventType].push(listener),this},TimeSlider.prototype.addEventData=function(aNewData){this.oLoading.show();this.oEventData.addData(aNewData);this.oEvents.changeData(),this.oStateLine.changeData(),this.oLoading.hide()},TimeSlider.prototype._reset=function(){this.oXAxis.reset(),this.oSelectionManager.reset(),this.oStateLine.reset(),this.oEvents.reset()},TimeSlider.prototype._resize=function(){this.oPositionManager.setWidth(this.$snap.width()),this.oBackground.reset(),this._reset()},TimeSlider.prototype.zoomIn=function(zoomLevel){this.oPositionManager.zoomIn(),this._reset()},TimeSlider.prototype.zoomOut=function(zoomLevel){this.oPositionManager.zoomOut(),this._reset()},TimeSlider.prototype.getSliderTimeSeries=function(){return this.oPositionManager.getSliderTimeSeries()},TimeSlider.GROUP_TYPE={TOP_BASE:"top-base",CONTENT_BASE:"content-base",BOTTOM_BASE:"bottom-base"},TimeSlider.oDrawOrder={background:0,"selection-zone":5,"time-series-signboard":7,"x-axis":10,events:10,"time-signboard":15,"selection-point":15,"state-line":20,"left-handler":25,"right-handler":25,guide:30,loading:100},TimeSlider.EventColor={base:"rgba(187, 187, 187, .3)",10100:"#009E00",10199:"#FAEBD7",10200:"#D15260",10201:"#E95C63",10300:"#FF9D7B",10301:"#F2F089",20100:"#00F"},w.TimeSlider=TimeSlider}(window,jQuery),function(w,$){var ts=w.TimeSlider;ts.EventData=function(timeSlider,aRawData){this.timeSlider=timeSlider,this._init(aRawData)},ts.EventData.prototype._init=function(aRawData){var self=this;this._aRawData=aRawData,this._oHash={},this._aRawData.forEach(function(o){self._oHash[o.eventTypeCode+"-"+o.eventTimestamp]=o})},ts.EventData.prototype.count=function(){return this._aRawData.length},ts.EventData.prototype.getData=function(index){return this._aRawData[index]},ts.EventData.prototype.addData=function(aNewData){this._aLastBoundary=this._getDataBoundary(aNewData),this._setEventData(aNewData)},ts.EventData.prototype.getBoundary=function(){return this._aLastBoundary},ts.EventData.prototype._getDataBoundary=function(aNewData){var beforeIndex=-1,afterIndex=Number.MAX_SAFE_INTEGER;if(0===this._aRawData.length)afterIndex=0;else for(var startTime=this._aRawData[0].eventTimestamp,endTime=this._aRawData[this._aRawData.length-1].eventTimestamp,len=aNewData.length,i=0;len>i;i++){var time=aNewData[i].eventTimestamp;if(startTime>time)beforeIndex=i;else if(time>endTime){afterIndex=i;break}}return[beforeIndex,afterIndex]},ts.EventData.prototype._setEventData=function(aNewData){var i;for(i=this._aLastBoundary[0];i>=0;i--)this._aRawData.unshift(aNewData[i]);for(i=this._aLastBoundary[1];i<aNewData.length;i++)this._aRawData.push(aNewData[i])}}(window,jQuery),function(w,$){var ts=w.TimeSlider;ts.Background=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.opt=options,this.group=svgGroup,this._addElements()},ts.Background.prototype._addElements=function(){this.rect=this.timeSlider.snap.rect(this.opt.left,this.opt.top,this.opt.width,this.opt.height),this.group.add(this.rect)},ts.Background.prototype.reset=function(){this.rect.animate({width:this.timeSlider.oPositionManager.getSliderEndPosition()},this.opt.duration,mina.easein)}}(window,jQuery),function(w,$){var ts=w.TimeSlider;ts.SelectionManager=function(timeSlider,options){this.timeSlider=timeSlider,this.opt=options,this.initClass()},ts.SelectionManager.prototype.initClass=function(){var self=this,aHandlerPosition=this.timeSlider.oPositionManager.getSelectionPosition();this.oSelectionZone=new TimeSlider.SelectionZone(this.timeSlider,this.timeSlider.getGroup("selection-zone",TimeSlider.GROUP_TYPE.CONTENT_BASE,TimeSlider.oDrawOrder["selection-zone"]),{top:0,left:aHandlerPosition[0],width:aHandlerPosition[1]-aHandlerPosition[0],height:this.opt.contentZoneHeight,duration:50}),this.oSelectionPoint=new TimeSlider.SelectionPoint(this.timeSlider,this.timeSlider.getGroup("selection-point",TimeSlider.GROUP_TYPE.CONTENT_BASE,TimeSlider.oDrawOrder["selection-point"]),{y:this.opt.headerZoneHeight,x:this.timeSlider.oPositionManager.getSelectPosition(),radius:this.opt.selectionPointRadius,height:this.opt.contentZoneHeight,duration:this.opt.duration,eventStartY:this.opt.headerZoneHeight,eventEndY:this.opt.height-this.opt.eventZoneHeight}),this.oLeftHandler=new TimeSlider.Handler(this.timeSlider,this.timeSlider.getGroup("left-handler",TimeSlider.GROUP_TYPE.CONTENT_BASE,TimeSlider.oDrawOrder["left-handler"]),{x:aHandlerPosition[0],zone:[0,aHandlerPosition[1]],height:this.opt.contentZoneHeight,margin:this.opt.margin,duration:50,handleSrc:this.opt.handleSrc},function(x){self.oLeftTimeSignboard.onDragStart(x)},function(x){self.oLeftTimeSignboard.onDrag(x)},function(bIsDraged,x){self.oLeftTimeSignboard.onDragEnd(),bIsDraged&&self.moveLeftHandler(x)}),this.oRightHandler=new TimeSlider.Handler(this.timeSlider,this.timeSlider.getGroup("right-handler",TimeSlider.GROUP_TYPE.CONTENT_BASE,TimeSlider.oDrawOrder["right-handler"]),{x:aHandlerPosition[1],zone:[aHandlerPosition[0],this.timeSlider.oPositionManager.getSliderEndPosition()],height:this.opt.contentZoneHeight,margin:this.opt.margin,duration:0,handleSrc:this.opt.handleSrc},function(x){self.oRightTimeSignboard.onDragStart(x)},function(x){self.oRightTimeSignboard.onDrag(x)},function(bIsDraged,x){self.oRightTimeSignboard.onDragEnd(),bIsDraged&&self.moveRightHandler(x)}),this.oLeftTimeSignboard=new TimeSlider.TimeSignboard(this.timeSlider,this.timeSlider.getGroup("time-left-signboard",TimeSlider.GROUP_TYPE.CONTENT_BASE,TimeSlider.oDrawOrder["time-signboard"]),{x:aHandlerPosition[0],direction:"left"}),this.oRightTimeSignboard=new TimeSlider.TimeSignboard(this.timeSlider,this.timeSlider.getGroup("time-right-signboard",TimeSlider.GROUP_TYPE.CONTENT_BASE,TimeSlider.oDrawOrder["time-signboard"]),{x:aHandlerPosition[1],direction:"right"})},ts.SelectionManager.prototype.moveLeftHandler=function(x){this.oRightHandler.setZone(x,this.timeSlider.oPositionManager.getSliderEndPosition()),this.timeSlider.oPositionManager.setSelectionStartPosition(x),this.oSelectionZone.redraw(),this._fireChangeZoneEvent()},ts.SelectionManager.prototype.moveRightHandler=function(x){this.oLeftHandler.setZone(0,x),this.timeSlider.oPositionManager.setSelectionEndPosition(x),this.oSelectionZone.redraw(),this._fireChangeZoneEvent()},ts.SelectionManager.prototype.moveSelectionAndHandler=function(x){var aNewSelectionZone=this.timeSlider.oPositionManager.getSelectionPosition();this.oLeftHandler.setPositionAndZone(aNewSelectionZone[0],[0,aNewSelectionZone[1]]),this.oRightHandler.setPositionAndZone(aNewSelectionZone[1],[aNewSelectionZone[0],this.timeSlider.oPositionManager.getSliderEndPosition()]),this.oSelectionZone.redraw(),this._fireChangeZoneEvent()},ts.SelectionManager.prototype.onMouseClick=function(event,x,y){y>this.opt.headerZoneHeight&&y<this.opt.headerZoneHeight+this.opt.contentZoneHeight&&(this.timeSlider.oPositionManager.setSelectPosition(x),this.timeSlider.oPositionManager.isInSelectionZone(x)===!1&&(this.timeSlider.oPositionManager.calcuSelectionZone(),this.moveSelectionAndHandler()),this.oSelectionPoint.onMouseClick(x),this.timeSlider.fireEvent("selectTime",this.timeSlider.oPositionManager.getTimeFromPosition(x)))},ts.SelectionManager.prototype._fireChangeZoneEvent=function(){var aNewSelectionZone=this.timeSlider.oPositionManager.getSelectionPosition();this.timeSlider.fireEvent("changeSelectionZone",[this.timeSlider.oPositionManager.getTimeFromPosition(aNewSelectionZone[0]),this.timeSlider.oPositionManager.getTimeFromPosition(aNewSelectionZone[1])])},ts.SelectionManager.prototype.reset=function(){var aNewSelectionZone=this.timeSlider.oPositionManager.getSelectionPosition();this.oLeftHandler.setPositionAndZone(aNewSelectionZone[0],[0,aNewSelectionZone[1]]),this.oRightHandler.setPositionAndZone(aNewSelectionZone[1],[aNewSelectionZone[0],this.timeSlider.oPositionManager.getSliderEndPosition()]),this.oSelectionZone.redraw(),this.oSelectionPoint.onMouseClick(this.timeSlider.oPositionManager.getSelectPosition())}}(window,jQuery),function(w,$){var consts={xAxisTicks:5},ts=w.TimeSlider;ts.PositionManager=function(options){this.width=options.width,this.minSliderTimeSeries=options.minSliderTimeSeries,this.maxSliderTimeSeries=options.maxSliderTimeSeries,this.startTime=options.sliderTimeSeries[0],this.endTime=options.sliderTimeSeries[1],this.timePerPoint=parseInt((this.endTime-this.startTime)/this.width);var handleTimeSeries=options.handleTimeSeries||[];this.aSelectionTimeSeries=2==handleTimeSeries.length?handleTimeSeries:[this.startTime,this.endTime],this.aSelectionZone=[this.getPositionFromTime(this.aSelectionTimeSeries[0]),this.getPositionFromTime(this.aSelectionTimeSeries[1])],this.xAxisTicks=options.xAxisTicks||consts.xAxisTicks,this.selectTime=options.selectTime,this.selectPosition=this.getPositionFromTime(options.selectTime)},ts.PositionManager.prototype.isBeforeSliderStartTime=function(time){return time<this.startTime},ts.PositionManager.prototype.isAfterSliderEndTime=function(time){return time>this.endTime},ts.PositionManager.prototype.getSliderEndTime=function(){return this.endTime},ts.PositionManager.prototype.setWidth=function(width){this.width=width,this._reset()},ts.PositionManager.prototype.getSliderEndPosition=function(){return this.width},ts.PositionManager.prototype.getSliderStartTimeStr=function(){return this._formatDate(new Date(this.startTime))},ts.PositionManager.prototype.getSliderEndTimeStr=function(){return this._formatDate(new Date(this.endTime))},ts.PositionManager.prototype.getFullTimeStr=function(x){return this._formatDate(new Date(this.getTimeFromPosition(x)))},ts.PositionManager.prototype._formatDate=function(d){var month=d.getMonth()+1;return d.getFullYear()+"."+this._twoChipers(month)+" "+this._twoChipers(d.getHours())+":"+this._twoChipers(d.getMinutes())+":"+this._twoChipers(d.getSeconds())},ts.PositionManager.prototype._twoChipers=function(n){return 10>n?"0"+n:n},ts.PositionManager.prototype.isInSelectionZone=function(x){return x<this.aSelectionZone[0]||this.aSelectionZone[1]<x?!1:!0},ts.PositionManager.prototype.isInSliderTimeSeries=function(time){return time<this.startTime||this.endTime<time?!1:!0},ts.PositionManager.prototype.getSliderTimeSeries=function(){return[this.startTime,this.endTime]},ts.PositionManager.prototype.getSelectionTimeSeries=function(){return this.aSelectionTimeSeries},ts.PositionManager.prototype.getSelectionPosition=function(){return this.aSelectionZone},ts.PositionManager.prototype.getSelectPosition=function(){return this.selectPosition},ts.PositionManager.prototype.setSelectPosition=function(x){this.selectPosition=x,this.selectTime=this.getTimeFromPosition(x)},ts.PositionManager.prototype.getTimeFromPosition=function(x){return this.startTime+this.timePerPoint*x},ts.PositionManager.prototype.getPositionFromTime=function(time){return parseInt((time-this.startTime)/this.timePerPoint)},ts.PositionManager.prototype.calcuSelectionZone=function(){var defaultZone=parseInt((this.aSelectionZone[1]-this.aSelectionZone[0])/2),zoneStart=this.selectPosition-defaultZone,zoneEnd=this.selectPosition+defaultZone;0>zoneStart?(zoneEnd+=Math.abs(zoneStart),zoneStart=0):zoneEnd>this.width&&(zoneStart-=zoneEnd-this.width,zoneEnd=this.width),this.aSelectionTimeSeries=[this.getTimeFromPosition(zoneStart),this.getTimeFromPosition(zoneEnd)],this.aSelectionZone=[zoneStart,zoneEnd]},ts.PositionManager.prototype.getXBarPosition=function(){for(var self=this,max=this.xAxisTicks+1,space=parseInt(this.width/max),a=[],i=0;max>i;i++)if(0!==i){var x=i*space;a.push({x:x,time:self.getTimeStr(x)})}return a},ts.PositionManager.prototype.getTimeStr=function(x){var timeX=x*this.timePerPoint+this.startTime,d=new Date(timeX);return this.formatTime(d.getHours())+":"+this.formatTime(d.getMinutes())},ts.PositionManager.prototype.formatTime=function(n){return 10>n?"0"+n:n},ts.PositionManager.prototype.setSelectionStartPosition=function(x){this.aSelectionTimeSeries[0]=this.getTimeFromPosition(x),this.aSelectionZone[0]=x},ts.PositionManager.prototype.setSelectionEndPosition=function(x){this.aSelectionTimeSeries[1]=this.getTimeFromPosition(x),this.aSelectionZone[1]=x},ts.PositionManager.prototype.zoomIn=function(){if(this.startTime!==this.aSelectionTimeSeries[0]||this.endTime!==this.aSelectionTimeSeries[1]){var quarter=parseInt((this.endTime-this.startTime)/4),tempCenterTime=this.aSelectionTimeSeries[0]+(this.aSelectionTimeSeries[1]-this.aSelectionTimeSeries[0])/2,tempStartTime=tempCenterTime-quarter,tempEndTime=tempCenterTime+quarter;if(tempEndTime-tempStartTime<this.minSliderTimeSeries){var minHalf=parseInt(this.minSliderTimeSeris/2);tempStartTime=tempCenterTime-minHalf,tempEndTime=tempCenterTime+minHalf}if(this.aSelectionTimeSeries[0]<=tempStartTime&&this.aSelectionTimeSeries[1]>=tempEndTime)this.aSelectionTimeSeries[0]=tempStartTime,this.aSelectionTimeSeries[1]=tempEndTime;else{var gap;this.aSelectionTimeSeries[0]<tempStartTime?(gap=tempStartTime-this.aSelectionTimeSeries[0],this.aSelectionTimeSeries[0]=tempStartTime,this.aSelectionTimeSeries[1]+gap>tempEndTime?this.aSelectionTimeSeries[1]=tempEndTime:this.aSelectionTimeSeries[1]=this.aSelectionTimeSeries[1]+gap):this.aSelectionTimeSeries[1]>tempEndTime&&(gap=this.aSelectionTimeSeries[1]-tempEndTime,this.aSelectionTimeSeries[1]=tempEndTime,this.aSelectionTimeSeries[0]-gap<tempStartTime?this.aSelectionTimeSeries[0]=tempStartTime:this.aSelectionTimeSeries[0]=this.aSelectionTimeSeries[0]-gap)}this.startTime=tempStartTime,this.endTime=tempEndTime,this._reset()}},ts.PositionManager.prototype.zoomOut=function(){var one=this.endTime-this.startTime,tempCenterTime=this.aSelectionTimeSeries[0]+(this.aSelectionTimeSeries[1]-this.aSelectionTimeSeries[0])/2;if(this.startTime=tempCenterTime-one,this.endTime=tempCenterTime+one,this.endTime-this.startTime>this.maxSliderTimeSeries){var maxHalf=parseInt(this.maxSliderTimeSeries/2);this.startTime=tempCenterTime-maxHalf,this.endTime=tempCenterTime+maxHalf}this._reset()},ts.PositionManager.prototype._reset=function(){this.timePerPoint=parseInt((this.endTime-this.startTime)/this.width),this.selectPosition=this.getPositionFromTime(this.selectTime),this.aSelectionZone=[this.getPositionFromTime(this.aSelectionTimeSeries[0]),this.getPositionFromTime(this.aSelectionTimeSeries[1])]}}(window,jQuery),function(w,$){var ts=w.TimeSlider;ts.SelectionZone=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.group=svgGroup,this.opt=options,this._addElements()},ts.SelectionZone.prototype._addElements=function(){var aSelectionZone=this.timeSlider.oPositionManager.getSelectionPosition();this.elZone=this.timeSlider.snap.rect(aSelectionZone[0],this.opt.top,aSelectionZone[1]-aSelectionZone[0],this.opt.height),this.group.add(this.elZone)},ts.SelectionZone.prototype.redraw=function(){var aSelectionZone=this.timeSlider.oPositionManager.getSelectionPosition();this.elZone.animate({x:aSelectionZone[0],width:aSelectionZone[1]-aSelectionZone[0]},this.opt.duration)}}(window,jQuery),function(w,$){w.TimeSlider.XAxis=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.group=svgGroup,this.opt=options,this.aSubGroup=[],this.aText=[],this.init()},w.TimeSlider.XAxis.prototype.init=function(){for(var aXBarPosition=this.timeSlider.oPositionManager.getXBarPosition(),halfX=this.opt.width/2,self=this,i=0;i<aXBarPosition.length;i++){var g=self.group.g();self.aText.push(self.timeSlider.snap.text(0,self.opt.textY,aXBarPosition[i].time)),g.attr("transform","translate("+halfX+", 0)"),g.add(self.aText[i],self.timeSlider.snap.line(0,self.opt.startY,0,self.opt.endY)),self.group.add(g),self.aSubGroup.push(g),self.setX(i,aXBarPosition[i].x,halfX)}},w.TimeSlider.XAxis.prototype.setX=function(index,x,startX){var ele=this.aSubGroup[index];3===arguments.length?Snap.animate(startX,x,function(val){ele.attr("transform","translate("+val+", 0)")},this.opt.duration):ele.attr("transform","translate("+x+", 0)")},w.TimeSlider.XAxis.prototype.reset=function(){for(var self=this,aYBarPosition=this.timeSlider.oPositionManager.getXBarPosition(),i=(this.opt.width/2,0);i<aYBarPosition.length;i++)self.aSubGroup[i].attr("transform","translate("+aYBarPosition[i].x+",0)"),self.aText[i].attr("text",aYBarPosition[i].time)}}(window,jQuery),function(w,$){var consts={AGENT_CONNECT:10100,AGENT_SHUTDOWN:10200,ID_POSTFIX:"-state-line"},ts=w.TimeSlider;ts.StateLine=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.group=svgGroup,this.opt=options,this._oEventData=timeSlider.oEventData,this._init(),this._addBaseLine(),this._addEventElements()},ts.StateLine.prototype._init=function(){this._filterShadow=this.timeSlider.snap.filter(Snap.filter.shadow(0,1,.5,"#000",.2)),this._oLineElementHash={},this._oEventDataHash={}},ts.StateLine.prototype._addBaseLine=function(){this._aBaseLine=[this._makeLine(0,this.opt.width,this.opt.topLineY,"base","base-"+Date.now()),this._makeLine(0,this.opt.width,this.opt.bottomLineY,"base","base-"+Date.now())],this.group.add(this._aBaseLine[0],this._aBaseLine[1])},ts.StateLine.prototype._addEventElements=function(){for(var len=this._oEventData.count(),i=0;len>i;i++)this._addEventElement(this._oEventData.getData(i))},ts.StateLine.prototype._addEventElement=function(oEvent){if("undefined"!=typeof oEvent.durationStartTimestamp){if(this.timeSlider.oPositionManager.isInSliderTimeSeries(oEvent.durationStartTimestamp)===!1&&this.timeSlider.oPositionManager.isInSliderTimeSeries(oEvent.durationEndTimestamp)===!1)return;this._addLine(this.timeSlider.oPositionManager.getPositionFromTime(oEvent.durationStartTimestamp),this._getX2(oEvent),oEvent)}this._oEventDataHash[this._getID(oEvent)]=oEvent},ts.StateLine.prototype._getID=function(oEvent){return oEvent.eventTypeCode+"-"+oEvent.eventTimestamp+consts.ID_POSTFIX},ts.StateLine.prototype._addLine=function(x,x2,oEvent){var lineID=this._getID(oEvent),elLineTop=this._makeLine(x,x2,this.opt.topLineY,oEvent.eventTypeCode,lineID),elLineBottom=this._makeLine(x,x2,this.opt.bottomLineY,oEvent.eventTypeCode,lineID);this._oLineElementHash[lineID]=[elLineTop,elLineBottom],this.group.add(elLineTop,elLineBottom)},ts.StateLine.prototype._makeLine=function(x,x2,y,eventType,id){return this.timeSlider.snap.line(x,y,x2,y).attr({stroke:TimeSlider.EventColor[eventType],"data-id":id,strokeWidth:this.opt.thickness})},ts.StateLine.prototype._getX2=function(oEvent){return this.timeSlider.oPositionManager.getPositionFromTime(-1==oEvent.durationEndTimestamp?this.timeSlider.oPositionManager.getSliderEndTime():oEvent.durationEndTimestamp)},ts.StateLine.prototype.changeData=function(){var i,aBoundary=this._oEventData.getBoundary();for(i=aBoundary[0];i>=0;i--)this._addEventElement(this._oEventData.getData(i));for(i=aBoundary[1];i<this._oEventData.count();i++)this._addEventElement(this._oEventData.getData(i));this.reset()},ts.StateLine.prototype.reset=function(){var self=this,oPM=this.timeSlider.oPositionManager;for(var p in this._oLineElementHash){var aLine=this._oLineElementHash[p],oEvent=this._oEventDataHash[p];aLine.forEach(function(elLine){elLine.animate({x1:oPM.getPositionFromTime(oEvent.durationStartTimestamp),x2:self._getX2(oEvent)},self.opt.duration)})}this._aBaseLine.forEach(function(elBase){elBase.animate({x2:oPM.getSliderEndPosition()},self.opt.duration)})},ts.StateLine.prototype.show=function(el){el.attr("display","block")},ts.StateLine.prototype.hide=function(el){el.attr("display","none")}}(window,jQuery),function(w,$){var consts={HANDLER_IMAGE_WIDTH:30,HANDLER_IMAGE_HEIGHT:18},ts=w.TimeSlider;ts.Handler=function(timeSlider,svgGroup,options,callbackStart,callbackDrag,callbackEnd){this.timeSlider=timeSlider,this.group=svgGroup,this.opt=options,this._previousX=options.x,this._handleSrc=options.handleSrc||consts.NORMAL_IMG,this._handleDownSrc=this._getHandleDownSrc(),this.callbackStart=callbackStart,this.callbackDrag=callbackDrag,this.callbackEnd=callbackEnd,this._addElements(),this.setX(options.x),this.addEvent()},ts.Handler.prototype._getHandleDownSrc=function(){var lastIndex=this._handleSrc.lastIndexOf(".");return this._handleSrc.substring(0,lastIndex)+"_down"+this._handleSrc.substring(lastIndex)},ts.Handler.prototype._addElements=function(){this.handlerGrip=this.timeSlider.snap.image(this._handleSrc,-(consts.HANDLER_IMAGE_WIDTH/2),-(consts.HANDLER_IMAGE_HEIGHT/2),consts.HANDLER_IMAGE_WIDTH,consts.HANDLER_IMAGE_HEIGHT),this.handlerGroup=this.group.g(),this.handlerGroup.add(this.timeSlider.snap.line(0,0,0,this.opt.height),this.handlerGrip)},ts.Handler.prototype.addEvent=function(callback){var self=this,lastX=-1;this.handlerGrip.mousedown(function(event,x,y){event.stopPropagation()}),this.handlerGrip.click(function(event,x,y){event.stopPropagation()}),this.handlerGrip.drag(function(dx,dy,x,y,event){var newX=x-self.opt.margin;self._isInRestirctionZone(newX)!==!1&&(self.handlerGroup.attr({transform:"translate("+newX+", 0)"}),lastX=newX,self.callbackDrag(newX))},function(x,y,event){event.stopPropagation(),self.handlerGrip.attr("href",self._handleDownSrc),self.callbackStart(x-self.opt.margin)},function(event){event.stopPropagation(),self.handlerGrip.attr("href",self._handleSrc),self._previousX!==lastX&&-1!==lastX?(self.callbackEnd(!0,lastX),self._previousX=lastX):self.callbackEnd(!1)})},ts.Handler.prototype.setX=function(x){this.handlerGroup.animate({transform:"translate("+x+", 0)"},this.opt.duration,mina.easeout)},ts.Handler.prototype._isInRestirctionZone=function(x){return x<=this.opt.zone[0]||x>=this.opt.zone[1]?!1:!0},ts.Handler.prototype.setZone=function(start,end){this.opt.zone=[start,end]},ts.Handler.prototype.setPositionAndZone=function(x,aZone){this.setX(x),this.callbackDrag(x),this.setZone(aZone[0],aZone[1])}}(window,jQuery),function(w,$){var ts=w.TimeSlider;ts.SelectionPoint=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.group=svgGroup,this.opt=options,this._addElements(),this.onMouseClick(options.x)},ts.SelectionPoint.prototype._addElements=function(){this.group.add(this.timeSlider.snap.line(0,0,0,this.opt.height),this.timeSlider.snap.circle(0,this.opt.height/2,this.opt.radius).attr({filter:this.timeSlider.snap.filter(Snap.filter.shadow(0,0,2,"#000",.3))}))},ts.SelectionPoint.prototype.onMouseClick=function(x){this.group.animate({transform:"translate("+x+", "+this.opt.y+")"},this.opt.duration,mina.easein)}}(window,jQuery),function(w,$){var consts={ID_POSTFIX:"-event-circle"},ts=w.TimeSlider;ts.Events=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.group=svgGroup,this._oEventData=timeSlider.oEventData,this._init(options),this._addEventElements(),this._addEvents()},ts.Events.prototype._init=function(options){this._oEventGroupElementHash={},this._oEventDataHash={},this.opt={y:4,barLength:4,gapBarNCircle:2,circleRadius:8};for(var p in options)this.opt[p]=options[p];this._filterShadow=this.timeSlider.snap.filter(Snap.filter.shadow(1,1,1,"#000",.3))},ts.Events.prototype._addEventElements=function(){for(var len=this._oEventData.count(),i=0;len>i;i++)this._addEventElement(this._oEventData.getData(i),!0)},ts.Events.prototype._addEventElement=function(oEvent,bAppend){this.timeSlider.oPositionManager.isInSliderTimeSeries(oEvent.eventTimestamp)!==!1&&this.group[bAppend?"append":"prepend"](this._makeElement(oEvent))},ts.Events.prototype._makeElement=function(oEvent){var opt=this.opt,time=oEvent.eventTimestamp,groupID=time+"-"+oEvent.eventTypeCode+consts.ID_POSTFIX,elEventGroup=this.group.g().attr({"data-id":groupID,transform:"translate("+this.timeSlider.oPositionManager.getPositionFromTime(time)+",0)"}).add(this.timeSlider.snap.line(0,opt.y,0,opt.y+opt.barLength),this.timeSlider.snap.circle(0,opt.y+opt.circleRadius+opt.gapBarNCircle+opt.barLength,opt.circleRadius).attr({fill:TimeSlider.EventColor[oEvent.eventTypeCode],"class":"event",filter:this._filterShadow,"data-time":time}));return this._oEventGroupElementHash[groupID]=elEventGroup,this._oEventDataHash[groupID]=oEvent,elEventGroup},ts.Events.prototype._addEvents=function(){var self=this;this.timeSlider;this.group.mouseover(function(event,x,y){self.timeSlider.fireEvent("inEvent",[x,y,self._oEventDataHash[event.srcElement.parentNode.getAttribute("data-id")]])}),this.group.mouseout(function(event,x,y){self.timeSlider.fireEvent("outEvent",[x,y,self._oEventDataHash[event.srcElement.parentNode.getAttribute("data-id")]])}),this.group.click(function(event,x,y){self.timeSlider.fireEvent("clickEvent",[x,y,self._oEventDataHash[event.srcElement.parentNode.getAttribute("data-id")]])})},ts.Events.prototype.reset=function(){var self=this;for(var p in this._oEventDataHash){var elGroupEvent=this._oEventGroupElementHash[p],time=this._oEventDataHash[p].eventTimestamp;self.timeSlider.oPositionManager.isInSliderTimeSeries(time)?(self.show(elGroupEvent),function(el,x){el.animate({transform:"translate("+x+",0)"},self.opt.duration)}(elGroupEvent,this.timeSlider.oPositionManager.getPositionFromTime(time))):!function(el,x){el.animate({transform:"translate("+x+",0)"},self.opt.duration,function(){self.hide(el)})}(elGroupEvent,self.timeSlider.oPositionManager.isBeforeSliderStartTime(time)?0:self.timeSlider.oPositionManager.getSliderEndPosition())}},ts.Events.prototype.changeData=function(){var i,aBoundary=this._oEventData.getBoundary();for(i=aBoundary[0];i>=0;i--)this._addEventElement(this._oEventData.getData(i),!1);for(i=aBoundary[1];i<this._oEventData.count();i++)this._addEventElement(this._oEventData.getData(i),!0);this.reset()},ts.Events.prototype.show=function(el){el.attr("display","block")},ts.Events.prototype.hide=function(el){el.attr("display","none")}}(window,jQuery),function(w,$){var ts=w.TimeSlider;ts.TimeSeriesSignboard=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.group=svgGroup,this.opt=options,this._init(),this._addElements()},ts.TimeSeriesSignboard.prototype._init=function(){this._halfHeight=this.opt.height-12},ts.TimeSeriesSignboard.prototype._addElements=function(){this._elStartTime=this.group.text(0,this._halfHeight,this.timeSlider.oPositionManager.getSliderStartTimeStr()).attr({"text-anchor":"start"}),this._elEndTime=this.group.text(this.timeSlider.oPositionManager.getSliderEndPosition(),this._halfHeight,this.timeSlider.oPositionManager.getSliderEndTimeStr()).attr({"text-anchor":"end"}),this.group.add(this._elStartTime,this._elEndTime)},ts.TimeSeriesSignboard.prototype.reset=function(){this._elStartTime.attr("text",this.timeSlider.oPositionManager.getSliderStartTimeStr()),this._elEndTime.attr("text",this.timeSlider.oPositionManager.getSliderEndTimeStr())},ts.TimeSeriesSignboard.prototype.resize=function(){var self=this;this._elEndTime.animate({x:self.timeSlider.oPositionManager.getSliderEndPosition()},this.opt.duration,function(){self._elEndTime.attr("text",self.timeSlider.oPositionManager.getSliderEndTimeStr())})}}(window,jQuery),function(w,$){var ts=w.TimeSlider;ts.TimeSignboard=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.group=svgGroup,this.opt=options,this._textMaxWidth=100,this._xPadding=2,this._addElements()},ts.TimeSignboard.prototype._addElements=function(){var isIn=this._isIn(this.opt.x),x=this.opt.x+(isIn?this._xPadding:-this._xPadding);this.timeText=this.group.text(x,26,this.timeSlider.oPositionManager.getFullTimeStr(this.opt.x)).attr({textAnchor:isIn?"start":"end"}),this.group.add(this.timeText)},ts.TimeSignboard.prototype.setX=function(x){var isIn=this._isIn(x);this.timeText.attr({x:x+(isIn?this._xPadding:-this._xPadding),text:this.timeSlider.oPositionManager.getFullTimeStr(x),textAnchor:isIn?"start":"end"})},ts.TimeSignboard.prototype._isIn=function(x){return"left"==this.opt.direction?x<this._textMaxWidth:x+this._textMaxWidth<this.timeSlider.oPositionManager.getSliderEndPosition();
},ts.TimeSignboard.prototype.onDragStart=function(x){this.setX(x)},ts.TimeSignboard.prototype.onDragEnd=function(){},ts.TimeSignboard.prototype.onDrag=function(x){this.setX(x)}}(window,jQuery),function(w,$){var consts={SIZE:30},ts=w.TimeSlider;ts.LoadingIndicator=function(timeSlider,svgGroup,options){this.timeSlider=timeSlider,this.opt=options,this.group=svgGroup,this._bRunn=!1,this._addElements(),this.show()},ts.LoadingIndicator.prototype._addElements=function(){var halfSize=consts.SIZE/2,x=this.opt.width/2-halfSize,y=this.opt.height/2-halfSize;this.group.add(this.timeSlider.snap.rect(0,0,this.opt.width,this.opt.height)),this.elClockwiseBox=this.timeSlider.snap.rect(x,y,consts.SIZE,consts.SIZE).attr({stroke:"rgba(197, 197, 197, .9)"}),this.elAnitclockwiseBox=this.timeSlider.snap.rect(x,y,consts.SIZE,consts.SIZE).attr({stroke:"rgba(239, 246, 105, .9)"}),this.group.add(this.elClockwiseBox,this.elAnitclockwiseBox)},ts.LoadingIndicator.prototype.show=function(){this.group.attr("display","block"),this._bRunn=!0,this._animate(this.elClockwiseBox,0,360,mina.easeout),this._animate(this.elAnitclockwiseBox,45,-315,mina.easein)},ts.LoadingIndicator.prototype._animate=function(ele,from,to,fnEase){var self=this;Snap.animate(from,to,function(val){ele.attr("transform","rotate("+val+"deg)")},self.opt.duration,fnEase,function(){self._bRunn===!0&&self._animate(ele,to,from,fnEase)})},ts.LoadingIndicator.prototype.hide=function(){this.group.attr("display","none"),this._bRunn=!1}}(window,jQuery);
//# sourceMappingURL=time-slider.min.js.map
